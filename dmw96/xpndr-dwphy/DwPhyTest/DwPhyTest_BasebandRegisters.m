function data = DwPhyTest_BasebandRegisters
% data = DwPhyTest_BasebandRegisters tests write/read access to DW52 baseband registers.

% Written by Barrett Brickner
% Copyright 2008 DSP Group, Inc., All Rights Reserved.

% Standard results
DwPhyLab_Setup;
data.Test = mfilename('fullpath');
data.Timestamp = datestr(now);
data.Result = 1;

% Put the baseband to sleep, then reset
DwPhyLab_Sleep; pause(0.001);
DwPhyCheck( DwPhyMex('DwPhy_Reset') );

% Clear DCXFastLoad so it does not interfere with testing the DCXAcc???
% registers (otherwise these get loaded when any DCX register is accessed)
x = DwPhyLab_ReadRegister(144);
DwPhyLab_WriteRegister(144, bitand(x, bin2dec('10111111')));

data.BasebandID = DwPhyLab_ReadRegister(1);
switch data.BasebandID,
    case {5,6}, data.WriteList = MojaveWriteableRegisters;
    case {7,8}, data.WriteList = NevadaWriteableRegisters;
    otherwise, error('Unsupported Baseband Type');
end
addr = data.WriteList(:,1);
mask = data.WriteList(:,2);

NumReg = length(addr);
y = zeros(NumReg,1);

for i=1:4,

    writedata = mod( (1:NumReg)+i, 256 ); % test data
    for k=1:NumReg,
        DwPhyLab_WriteRegister(addr(k), writedata(k));
    end
    for k=1:NumReg,
        y(k) = DwPhyLab_ReadRegister(addr(k));
        difference = bitand( bitxor( writedata(k), y(k) ), mask(k) );
        if difference ~=0,
            data.Result = 0; % test failed
            fprintf('> %s failed on register %4d (write = 0x%s, read = 0x%s)\n', ...
                mfilename, data.WriteList(k,1), dec2hex(writedata(k),2), dec2hex(y(k),2));
        end
    end
    
end    

%% MojaveWriteableRegisters - array with [addr, mask]
function CheckList = MojaveWriteableRegisters
% Same as BAR2 but mask out serial port bits
CheckList = [
     3      3
     4      3
     6    239
     7    127
     8    255
    12    255
    13    255
    14    127
    24    255
    25      3
    30    127
    31      7
    64    127
    65     63
    66    127
    67    127
    68    127
    69    127
    70     31
    71     31
    72     31
    73     63
    74     31
    75     63
    76     31
    77     31
    78     63
    79     63
    80    247
    81    255
    82    255
    83    127
    84    127
    87    253
    88     55
    89     15
    90    255
    91    255
    92    255
    93    127
    96    127
    97     31
    98    255
    99     15
   100    255
   101    255
   102    255
   103    190
   104     31
   105     63
   112     63
   113    255
   114    255
   115    255
   116    128
   120    159
   121    255
   122     31
   128     15
   132     63
   133     63
   134     63
   135     63
   144    167
   145     31
   146    255
   147     31
   148    255
   149     31
   150    255
   151     31
   152    255
   160    255
   161    247
   162     63
   163     63
   164     63
   165     63
   166     63
   167     63
   168     63
   169     31
   170     63
   171     31
   172     63
   173     31
   174     31
   175     15
   176     15
   177     63
   178    255
   179    255
   181    255
   182    255
   184     63
   185    119
   186    119
   187      7
   188    255
   197     23
   198    243
   199    255
   200    255
   201    255
   202    255
   203    255
   204    255
   205    255
   206    243
   208    255
   209    255
   210    255
   211    255
   212    255
   213    255
   214    255
   215    255
   216    255
   217    255
   218    255
   219    255
   220    255
   221     63
   222    255
   223     15
   224    255
   225     63
   226     63
   227     63
   228    255
   229    255
   230    207
   231    255
   232    223
   233      7
   234      7
   235    255
   236    255
   237    135
   768    126
   769    255
   770    255
   771    255
   772    255
   773    255
   774    255
   775    255
   776    255
   784    255
   800      3
   801    127
];

CheckList = [
     3      3
     4      3
     6    239
     7    127
     8    255
    12    255
    13    255
    14    127
    24    255
    25      3
    64    127
    65     63
    66    127
    67    127
    68    127
    69    127
    70     31
    71     31
    72     31
    73     63
    74     31
    75     63
    76     31
    77     31
    78     63
    79     63
    80    247
    81    255
    82    255
    83    127
    84    127
    87    253
    88     55
    89     15
    90    255
    91    255
    92    255
    93    127
    96    127
    97     31
    98    255
    99     15
   100    255
   101    255
   102    255
   103    190
   104     31
   105     63
   112     63
   113    255
   114    255
   115    255
   116    128
   120    159
   121    255
   122     31
   128     15
   132     63
   133     63
   134     63
   135     63
   144    167
   145     31
   146    255
   147     31
   148    255
   149     31
   150    255
   151     31
   152    255
   160    255
   161    247
   162     63
   163     63
   164     63
   165     63
   166     63
   167     63
   168     63
   169     31
   170     63
   171     31
   172     63
   173     31
   174     31
   175     15
   176     15
   177     63
   178    255
   179    255
   181    255
   182    255
   184     63
   185    119
   186    119
   187      7
   188    255
   197     23
   198    243
   199    255
   200    255
   201    255
   202    255
   203    255
   204    255
   205    255
   206    243
   208    255
   209    255
   210    255
   211    255
   212    255
   213    255
   214    255
   215    255
   216    255
   217    255
   218    255
   219    255
   220    255
   221     63
   222    255
   223     15
   224    255
   225     63
   226     63
   227     63
   228    255
   229    255
   230    207
   231    255
   232    223
   233      7
   234      7
   235    255
   236    255
   237    135
];

%% NevadaWriteableRegisters - array with [addr, mask]
function CheckList = NevadaWriteableRegisters
CheckList = [
     3      3
     4      7
     5     15
     6    207
     7    255
     8    255
    10    129
    12    255
    13    255
    14    127
    24    255
    25     13
    26    255
    27    255
    28    255
    29    255
    30    127
    31      7
    32     63
    33     63
    36      1
    37     31
    38     31
    39     31
    40      3
    41     31
    42     31
    43     31
    44     31
    45     31
    46     31
    48     15
    49    255
    50     15
    51    255
    52    255
    53    255
    54    255
    55      7
    59    255
    60    251
    61    127
    62     63
    63     31
    64    127
    65     63
    66    127
    67    127
    68    127
    69    127
    70     31
    71     31
    72     31
    73     63
    74     31
    75     63
    76     31
    77     31
    78     31
    80    247
    81    255
    82    255
    83    127
    84    127
    85     63
    87    189
    88     55
    89     15
    90    255
    91    255
    92    255
    93    127
    96    127
    97     31
    98    255
    99     15
   100    255
   101     31
   102    255
   103    255
   104     31
   105     63
   106    255
   107    225
   112     63
   113    255
   114    255
   115    255
   116    128
   120    159
   121    255
   122     31
   128     15
   130    191
   132     63
   133     63
   134     63
   135     63
   136    255
   140      3
   141    255
   142      3
   143    255
   144    231
   145     31
   146    255
   147     31
   148    255
   149     31
   150    255
   151     31
   152    255
   160    255
   161    247
   162     63
   163     63
   164     63
   165     63
   166     63
   167     63
   168     63
   169     31
   170     63
   171     31
   172     63
   173     31
   174     31
   175     15
   176     15
   177     63
   178    255
   179    255
   181    255
   182    255
   183    255
   184     63
   185    119
   186    119
   187      7
   188    255
   197    255
   198    247
   199    255
   200    255
   201    255
   202    255
   203    255
   204    255
   205    255
   206    255
   207    127
   208    255
   209    255
   210    255
   211    255
   212    255
   213    255
   214    255
   215    255
   216    255
   217    255
   218    255
   219    255
   220    255
   221     63
   222    255
   224    255
   225     63
   226    255
   227    255
   228    255
   229    255
   230    247
   231    255
   232    255
   233     31
   234    199
   235    255
   236    255
   237    199
   238    255
   239    255
   240    255
   241    255
   242    255
   243    255
   244    255
   245    255
   246    255
   247    255
   248    255
   512    255
   513     31
   514    255
   515     31
   516    255
   517     31
   518    255
   519     31
   520    255
   521     31
   522    255
   523     31
   524    255
   525     31
   526    255
   527     31
   528    255
   529     31
   530    255
   531     31
   532    255
   533    127
   534    255
   535    127
   536    255
   537    127
   538    255
   539    127
   540    255
   541    127
   542    255
   543    127
   544    255
   545     15
   546    255
   547     15
   548    255
   549     15
   550    255
   551     15
   552    255
   553     15
   554    255
   555     15
   556    255
   557     31
   558    255
   559     31
   560    255
   561     31
   562    255
   563     31
   564    255
   565     31
   566    255
   567     31
   568    255
   569     31
   570    255
   571     31
   572    255
   573     31
   574    255
   575     31
   576    255
   577    127
   578    255
   579    127
   580    255
   581    127
   582    255
   583    127
   584    255
   585    127
   586    255
   587    127
   588    255
   589     15
   590    255
   591     15
   592    255
   593     15
   594    255
   595     15
   596    255
   597     15
   598    255
   599     15
   600    255
   601     31
   602    255
   603     31
   604    255
   605     31
   606    255
   607     31
   608    255
   609     31
   610    255
   611     31
   612    255
   613     31
   614    255
   615     31
   616    255
   617     31
   618    255
   619     31
   620    255
   621    127
   622    255
   623    127
   624    255
   625    127
   626    255
   627    127
   628    255
   629    127
   630    255
   631    127
   632    255
   633     15
   634    255
   635     15
   636    255
   637     15
   638    255
   639     15
   640    255
   641     15
   642    255
   643     15
   644    255
   645     31
   646    255
   647     31
   648    255
   649     31
   650    255
   651     31
   652    255
   653     31
   654    255
   655     31
   656    255
   657     31
   658    255
   659     31
   660    255
   661     31
   662    255
   663     31
   664    255
   665    127
   666    255
   667    127
   668    255
   669    127
   670    255
   671    127
   672    255
   673    127
   674    255
   675    127
   676    255
   677     15
   678    255
   679     15
   680    255
   681     15
   682    255
   683     15
   684    255
   685     15
   686    255
   687     15
   688     63
   689     63
   690     63
   692    255
   693    255
   694    255
   695     31
   768    126
   769    255
   770    255
   771    255
   772    255
   773    255
   774    255
   775    255
   776    255
   784    255
   800      3
   801    127
   824      1
  1016    255
  1017     15
  1018     63
  1019     63
  1020    255
  1022    255
];

%% REVISIONS
% 2010-05-25 Add Nevada registers
% 2011-04-29 Updated write mask for registers 695, 696, 768
