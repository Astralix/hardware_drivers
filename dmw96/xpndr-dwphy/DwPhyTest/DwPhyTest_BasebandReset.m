function data = DwPhyTest_BasebandReset
%DwPhyTest_BasebandReset - Reset the baseband and verify register values

% Written by Barrett Brickner
% Copyright 2008 DSP Group, Inc., All Rights Reserved.

% Standard results
data.Description = mfilename('fullpath');
data.Timestamp = datestr(now);
data.Result = 1;

% Put the baseband to sleep, then reset
DwPhyLab_Setup;
DwPhyLab_Sleep;
DwPhyCheck( DwPhyMex('DwPhy_Reset') );

% Now, read back registers and compare with expected defaults
data.BasebandID = DwPhyLab_ReadRegister(1);
switch data.BasebandID,
    case {5,6}, data.CheckList = MojaveResetRegValues;
    case {7}, data.CheckList = NevadaResetRegValues_FPGA;
    case {8}, data.CheckList = NevadaResetRegValues;                
    otherwise, error('Unsupported Baseband ID');
end
% Debubbing - Print to file NevadaResetRegValues.txt  NevadaResetRegValues  directly from  Nevada
% FileName = 'NevadaResetRegValues.txt'
% fileNamePrint  = fopen(FileName,'w');
 fail_cnt = 0;
for i=1:length(data.CheckList),
    data.Reg(i,1) = data.CheckList(i,1);
    data.Reg(i,2) = DwPhyLab_ReadRegister(data.Reg(i,1));
    
    mask = data.CheckList(i,3);
    if( bitand(data.CheckList(i,2),mask) ~= bitand(data.Reg(i,2),mask) )
        data.Result = 0; % test failed
        fprintf('> %s failed on register %d CheckList = %d Register  =  %d\n',mfilename,data.CheckList(i,1),bitand(data.CheckList(i,2),mask),bitand(data.Reg(i,2),mask));
        fail_cnt = fail_cnt+1;
%        fprintf(fileNamePrint,'\t%4d\t %4d\t %4d\t %% was %4d\n',data.CheckList(i,1),bitand(data.Reg(i,2),mask),data.CheckList(i,3),data.CheckList(i,2));      
    else
%        fprintf(fileNamePrint,'\t%4d\t %4d\t %4d\n',data.CheckList(i,1),data.CheckList(i,2),data.CheckList(i,3));             
    end

end
fail_cnt
%fclose(fileNamePrint); 
%edit(FileName);
% Check the radio by changing a register and then resetting it
A = 256 + 2; % radio address 2 is antenna select
data.X0 = DwPhyLab_ReadRegister(A);
DwPhyLab_WriteRegister(A, bitxor(data.X0,3));
data.X1 = DwPhyLab_ReadRegister(A);
DwPhyCheck( DwPhyMex('DwPhy_Reset') );
data.X2 = DwPhyLab_ReadRegister(A);

if(data.X0 ~= data.X2)
    data.Result = 0;
    fprintf('> %s failed on radio register reset\n',mfilename);
end

%% MojaveResetRegValue - array with [addr, mask, value]
function CheckList = MojaveResetRegValues
CheckList = [
     3      3      3
     4      3      3
     6    239     35
     7    127      0
     8    255     20
    12    255      0
    13    255      0
    14    127    127
    24    255    255
    25      3      3
    30    127      3
    31      7      0
    64    127     60
    65     63     37
    66    127      0
    67    127     56
    68    127     72
    69    127     68
    70     31     20
    71     31     12
    72     31      8
    73     63     13
    74     31     14
    75     63     63
    76     31      0
    77     31      9
    78     63     20
    79     63     50
    80    247     19
    81    255     51
    82    255     72
    83    127     30
    84    127     18
    87    253     61
    88     55     36
    89     15      4
    90    255     70
    91    255    195
    92    255    128
    93    127     25
    96    127     12
    97     31     15
    98    255    144
    99     15      4
   100    255     20
   101    255     92
   102    255     60
   103    190    176
   104     31     20
   105     63     28
   112     63      4
   113    255      0
   114    255     17
   115    255    162
   116    128      0
   120    159    132
   121    255     76
   122     31     16
   128     15      4
   132     63     21
   133     63     31
   134     63     21
   135     63     31
   144    231    194
   145     31      0
   146    255      0
   147     31      0
   148    255      0
   149     31      0
   150    255      0
   151     31      0
   152    255      0
   160    255     66
   161    247     35
   162     63     21
   163     63     26
   164     63     22
   165     63     50
   166     63     32
   167     63     37
   168     63     40
   169     31     10
   170     63     28
   171     31     14
   172     63     63
   173     31      0
   174     31      8
   175     15     12
   176     15      7
   177     63     31
   178    255     90
   179    255     45
   181    255     32
   182    255    102
   184     63     16
   185    119     53
   186    119     17
   187      7      5
   188    255    144
   197     23      0
   198    243     48
   199    255    255
   200    255    255
   201    255    255
   202    255    255
   203    255    255
   204    255    255
   205    255     30
   206    243    128
   208    255      0
   209    255    220
   210    255     20
   211    255      8
   212    255      8
   213    255      8
   214    255      2
   215    255      1
   216    255    103
   217    255     67
   218    255     67
   219    255    100
   220    255     33
   221     63     24
   222    255      1
   223     15     15
   224    255     30
   225     63     11
   226     63      7
   227     63      7
   228    255    165
   229    255     60
   230    207      0
   231    255      0
   232    223    215
   233      7      6
   234      7      0
   235    255    128
   236    255    128
   237    135    133
   768    127      0
   769    255      0
   770    255      0
   771    255      0
   772    255      0
   773    255      0
   774    255      0
   775    255      0
   776    255      0
   784    255      0
   800      3      0
   801    127      0
];

%% NevadaResetRegValue - array with [addr, mask, value]
function CheckList = NevadaResetRegValues_FPGA
%
% 
%
CheckList = [
     1      7    255
     3      3      3
     4      1      7
     5      0     15
     6      3    207
     7      0    255
     8     20    255
     9     20    255
    10      1    129
    12      0    255
    13      0    255
    14    127    127
    24    255    255
    25      5     13
    26    255    255
    27    255    255
    28     38    255
    29    248    255
    30      3    127
    31      0      7
    32     17     63
    33      2     63
    36      0      1
    37      0     31
    38      0     31
    39      0     31
    40      0      3
    41      0     31
    42      0     31
    43      0     31
    44      0     31
    45      0     31
    46      0     31
    48      6     15
    49    121    255
    50      4     15
    51    183    255
    52     80    255
    53      8    255
    54      0    255
    55      0      7
    59      0    255
    60    235    251
    61     63    127
    62     32     63
    63     30     31
    64     60    127
    65     37     63
    66      0    127
    67     56    127
    68     72    127
    69     68    127
    70     20     31
    71     12     31
    72      8     31
    73     13     63
    74     14     31
    75     63     63
    76      0     31
    77      9     31
    78     10     31
    80    114    247
    81     51    255
    82     72    255
    83     30    127
    84     18    127
    85      0     63
    87     61    189
    88     36     55
    89      4     15
    90     70    255
    91    195    255
    92    128    255
    93     25    127
    96     12    127
    97     15     31
    98    144    255
    99      4     15
   100     20    255
   101     28     31
   102     60    255
   103    176    255
   104     20     31
   105     28     63
   106    172    255
   107      0    225
   112      4     63
   113      0    255
   114     17    255
   115    162    255
   116      0    128
   120    132    159
   121     76    255
   122     16     31
   128      4     15
   130      0    191
   132     21     63
   133     31     63
   134     21     63
   135     31     63
   136      2    255
   140      2      3
   141      0    255
   142      2      3
   143      0    255
   144    194    231
   160     66    255
   161     35    247
   162     21     63
   163     26     63
   164     22     63
   165     50     63
   166     32     63
   167     37     63
   168     40     63
   169     10     31
   170     28     63
   171     14     31
   172     63     63
   173      0     31
   174      8     31
   175     12     15
   176      7     15
   177     31     63
   178     90    255
   179     45    255
   181     32    255
   182    102    255
   183     66    255
   184     16     63
   185     53    119
   186     17    119
   187      5      7
   188    144    255
   197    192    255
   198     48    247
   199    255    255
   200    255    255
   201    255    255
   202    255    255
   203    255    255
   204    255    255
   205     30    255
   206    128    255
   207     64    127
   208      0    255
   209    220    255
   210     20    255
   211      8    255
   212      8    255
   213      8    255
   214      2    255
   215      1    255
   216    103    255
   217     67    255
   218     67    255
   219    100    255
   220     33    255
   221     24     63
   222      1    255
   224     30    255
   225     11     63
   226      7    255
   227      7    255
   228    165    255
   229     60    255
   231      0    255
   232    215    255
   233      6     31
   234      0    199
   235    128    255
   236    128    255
   237    133    199
   238      0    255
   239      0    255
   240    127    255
   241     15    255
   242     45    255
   243     37    255
   244     32    255
   245     24    255
   246    200    255
   247    200    255
   248    169    255
   512      0    255
   513      0     31
   514      0    255
   515      0     31
   516      0    255
   517      0     31
   518      0    255
   519      0     31
   520      0    255
   521      0     31
   522      0    255
   523      0     31
   524      0    255
   525      0     31
   526      0    255
   527      0     31
   528      0    255
   529      0     31
   530      0    255
   531      0     31
   532      0    255
   533      0    127
   534      0    255
   535      0    127
   536      0    255
   537      0    127
   538      0    255
   539      0    127
   540      0    255
   541      0    127
   542      0    255
   543      0    127
   544      0    255
   545      0     15
   546      0    255
   547      0     15
   548      0    255
   549      0     15
   550      0    255
   551      0     15
   552      0    255
   553      0     15
   554      0    255
   555      0     15
   556      0    255
   557      0     31
   558      0    255
   559      0     31
   560      0    255
   561      0     31
   562      0    255
   563      0     31
   564      0    255
   565      0     31
   566      0    255
   567      0     31
   568      0    255
   569      0     31
   570      0    255
   571      0     31
   572      0    255
   573      0     31
   574      0    255
   575      0     31
   576      0    255
   577      0    127
   578      0    255
   579      0    127
   580      0    255
   581      0    127
   582      0    255
   583      0    127
   584      0    255
   585      0    127
   586      0    255
   587      0    127
   588      0    255
   589      0     15
   590      0    255
   591      0     15
   592      0    255
   593      0     15
   594      0    255
   595      0     15
   596      0    255
   597      0     15
   598      0    255
   599      0     15
   600      0    255
   601      0     31
   602      0    255
   603      0     31
   604      0    255
   605      0     31
   606      0    255
   607      0     31
   608      0    255
   609      0     31
   610      0    255
   611      0     31
   612      0    255
   613      0     31
   614      0    255
   615      0     31
   616      0    255
   617      0     31
   618      0    255
   619      0     31
   620      0    255
   621      0    127
   622      0    255
   623      0    127
   624      0    255
   625      0    127
   626      0    255
   627      0    127
   628      0    255
   629      0    127
   630      0    255
   631      0    127
   632      0    255
   633      0     15
   634      0    255
   635      0     15
   636      0    255
   637      0     15
   638      0    255
   639      0     15
   640      0    255
   641      0     15
   642      0    255
   643      0     15
   644      0    255
   645      0     31
   646      0    255
   647      0     31
   648      0    255
   649      0     31
   650      0    255
   651      0     31
   652      0    255
   653      0     31
   654      0    255
   655      0     31
   656      0    255
   657      0     31
   658      0    255
   659      0     31
   660      0    255
   661      0     31
   662      0    255
   663      0     31
   664      0    255
   665      0    127
   666      0    255
   667      0    127
   668      0    255
   669      0    127
   670      0    255
   671      0    127
   672      0    255
   673      0    127
   674      0    255
   675      0    127
   676      0    255
   677      0     15
   678      0    255
   679      0     15
   680      0    255
   681      0     15
   682      0    255
   683      0     15
   684      0    255
   685      0     15
   686      0    255
   687      0     15
   688      0     63
   689      0     63
   690      0     63
   692      0    255
   693      0    255
   694      0    255
   695      0    255
   696      0    127
   768      0    127
   769      0    255
   770      0    255
   771      0    255
   772      0    255
   773      0    255
   774      0    255
   775      0    255
   776      0    255
   784      0    255
   800      0      3
   801      0    127
  1016      0    255
  1017      0     15
  1018      0     63
  1019      0     63
  1020    127    255
  1022      0    255
];
%% NevadaResetRegValue - array with [addr, mask, value]
function CheckList = NevadaResetRegValues
%
% For FPGA work, remove registers 145-152, 230, and 824
%
CheckList = [
	   1	    8	  255	 % was    7
	   3	    2	    3	 % was    3
	   4	    7	    7	 % was    1
	   5	    0	   15
	   6	    3	  207
	   7	    0	  255
	   8	   18	  255	 % was   20
	   9	   20	  255
	  10	    0	  129	 % was    1
	  12	    0	  255
	  13	    0	  255
	  14	  127	  127
	  24	  255	  255
	  25	   13	   13	 % was    5
	  26	  255	  255
	  27	  255	  255
	  28	   38	  255
	  29	  248	  255
	  30	   67	  127	 % was    3
	  31	    0	    7
	  32	   12	   63	 % was   17
	  33	   23	   63	 % was    2
	  36	    0	    1
	  37	    0	   31
	  38	    0	   31
	  39	    0	   31
	  40	    0	    3
	  41	    0	   31
	  42	    0	   31
	  43	    0	   31
	  44	    0	   31
	  45	    0	   31
	  46	    0	   31
	  48	    6	   15
	  49	  121	  255
	  50	    4	   15
	  51	  180	  255	 % was  183
	  52	   80	  255
	  53	   24	  255	 % was    8
	  54	    0	  255
	  55	    0	    7
	  59	   28	  255	 % was    0
	  60	  234	  251	 % was  235
	  61	   40	  127	 % was   63
	  62	   30	   63	 % was   32
	  63	   15	   31	 % was   30
	  64	   60	  127
	  65	   32	   63	 % was   37
	  66	    0	  127
	  67	   56	  127
	  68	   72	  127
	  69	   66	  127	 % was   68
	  70	   20	   31
	  71	   12	   31
	  72	    8	   31
	  73	   18	   63	 % was   13
	  74	   12	   31	 % was   14
	  75	   63	   63
	  76	    0	   31
	  77	    9	   31
	  78	   10	   31
	  80	  114	  247
	  81	   44	  255	 % was   51
	  82	  104	  255	 % was   72
	  83	   30	  127
	  84	   18	  127
	  85	   23	   63	 % was    0
	  87	   61	  189
	  88	    4	   55	 % was   36
	  89	    6	   15	 % was    4
	  90	   42	  255	 % was   70
	  91	  195	  255
	  92	  128	  255
	  93	   25	  127
	  96	   16	  127	 % was   12
	  97	   15	   31
	  98	  144	  255
	  99	    4	   15
	 100	   20	  255
	 101	   28	   31
	 102	   60	  255
	 103	  240	  255	 % was  176
	 104	   20	   31
	 105	   28	   63
	 106	  172	  255
	 107	    0	  225
	 112	    4	   63
	 113	    0	  255
	 114	   36	  255	 % was   17
	 115	  130	  255	 % was  162
	 116	  128	  128	 % was    0
	 120	  132	  159
	 121	   92	  255	 % was   76
	 122	   16	   31
	 128	    4	   15
	 130	  163	  191	 % was    0
	 132	   21	   63
	 133	   31	   63
	 134	   21	   63
	 135	   31	   63
	 136	    2	  255
	 140	    0	    3	 % was    2
	 141	    0	  255
	 142	    0	    3	 % was    2
	 143	    0	  255
	 144	  130	  231	 % was  194
	 160	  143	  255	 % was   66
	 161	   35	  247
	 162	   30	   63	 % was   21
	 163	   26	   63
	 164	   22	   63
	 165	   50	   63
	 166	   32	   63
	 167	   37	   63
	 168	   40	   63
	 169	   10	   31
	 170	   28	   63
	 171	   12	   31	 % was   14
	 172	   63	   63
	 173	    0	   31
	 174	    8	   31
	 175	   12	   15
	 176	    7	   15
	 177	   31	   63
	 178	   90	  255
	 179	   45	  255
	 181	   32	  255
	 182	  102	  255
	 183	   33	  255	 % was   66
	 184	   16	   63
	 185	   53	  119
	 186	   17	  119
	 187	    5	    7
	 188	  144	  255
	 197	   28	  255	 % was  192
	 198	  240	  247	 % was   48
	 199	  255	  255
	 200	  255	  255
	 201	  255	  255
	 202	  255	  255
	 203	  255	  255
	 204	  255	  255
	 205	   30	  255
	 206	  203	  255	 % was  128
	 207	   48	  127	 % was   64
	 208	    1	  255	 % was    0
	 209	  124	  255	 % was  220
	 210	   80	  255	 % was   20
	 211	   13	  255	 % was    8
	 212	   13	  255	 % was    8
	 213	   12	  255	 % was    8
	 214	    8	  255	 % was    2
	 215	    7	  255	 % was    1
	 216	  188	  255	 % was  103
	 217	  128	  255	 % was   67
	 218	  179	  255	 % was   67
	 219	  100	  255
	 220	   15	  255	 % was   33
	 221	   24	   63
	 222	  241	  255	 % was    1
	 224	   30	  255
	 225	   11	   63
	 226	    7	  255
	 227	    7	  255
	 228	  195	  255	 % was  165
	 229	   60	  255
	 231	    3	  255	 % was    0
	 232	  150	  255	 % was  215
	 233	    4	   31	 % was    6
	 234	    2	  199	 % was    0
	 235	  128	  255
	 236	  128	  255
	 237	  133	  199
	 238	   80	  255	 % was    0
	 239	    0	  255
	 240	  127	  255
	 241	   15	  255
	 242	   48	  255	 % was   45
	 243	   40	  255	 % was   37
	 244	   32	  255
	 245	   24	  255
	 246	  197	  255	 % was  200
	 247	  197	  255	 % was  200
	 248	  165	  255	 % was  169
	 512	    0	  255
	 513	    0	   31
	 514	    0	  255
	 515	    0	   31
	 516	    0	  255
	 517	    0	   31
	 518	    0	  255
	 519	    0	   31
	 520	    0	  255
	 521	    0	   31
	 522	    0	  255
	 523	    0	   31
	 524	    0	  255
	 525	    0	   31
	 526	    0	  255
	 527	    0	   31
	 528	    0	  255
	 529	    0	   31
	 530	    0	  255
	 531	    0	   31
	 532	    0	  255
	 533	    0	  127
	 534	    0	  255
	 535	    0	  127
	 536	    0	  255
	 537	    0	  127
	 538	    0	  255
	 539	    0	  127
	 540	    0	  255
	 541	    0	  127
	 542	    0	  255
	 543	    0	  127
	 544	    0	  255
	 545	    0	   15
	 546	    0	  255
	 547	    0	   15
	 548	    0	  255
	 549	    0	   15
	 550	    0	  255
	 551	    0	   15
	 552	    0	  255
	 553	    0	   15
	 554	    0	  255
	 555	    0	   15
	 556	    0	  255
	 557	    0	   31
	 558	    0	  255
	 559	    0	   31
	 560	    0	  255
	 561	    0	   31
	 562	    0	  255
	 563	    0	   31
	 564	    0	  255
	 565	    0	   31
	 566	    0	  255
	 567	    0	   31
	 568	    0	  255
	 569	    0	   31
	 570	    0	  255
	 571	    0	   31
	 572	    0	  255
	 573	    0	   31
	 574	    0	  255
	 575	    0	   31
	 576	    0	  255
	 577	    0	  127
	 578	    0	  255
	 579	    0	  127
	 580	    0	  255
	 581	    0	  127
	 582	    0	  255
	 583	    0	  127
	 584	    0	  255
	 585	    0	  127
	 586	    0	  255
	 587	    0	  127
	 588	    0	  255
	 589	    0	   15
	 590	    0	  255
	 591	    0	   15
	 592	    0	  255
	 593	    0	   15
	 594	    0	  255
	 595	    0	   15
	 596	    0	  255
	 597	    0	   15
	 598	    0	  255
	 599	    0	   15
	 600	    0	  255
	 601	    0	   31
	 602	    0	  255
	 603	    0	   31
	 604	    0	  255
	 605	    0	   31
	 606	    0	  255
	 607	    0	   31
	 608	    0	  255
	 609	    0	   31
	 610	    0	  255
	 611	    0	   31
	 612	    0	  255
	 613	    0	   31
	 614	    0	  255
	 615	    0	   31
	 616	    0	  255
	 617	    0	   31
	 618	    0	  255
	 619	    0	   31
	 620	    0	  255
	 621	    0	  127
	 622	    0	  255
	 623	    0	  127
	 624	    0	  255
	 625	    0	  127
	 626	    0	  255
	 627	    0	  127
	 628	    0	  255
	 629	    0	  127
	 630	    0	  255
	 631	    0	  127
	 632	    0	  255
	 633	    0	   15
	 634	    0	  255
	 635	    0	   15
	 636	    0	  255
	 637	    0	   15
	 638	    0	  255
	 639	    0	   15
	 640	    0	  255
	 641	    0	   15
	 642	    0	  255
	 643	    0	   15
	 644	    0	  255
	 645	    0	   31
	 646	    0	  255
	 647	    0	   31
	 648	    0	  255
	 649	    0	   31
	 650	    0	  255
	 651	    0	   31
	 652	    0	  255
	 653	    0	   31
	 654	    0	  255
	 655	    0	   31
	 656	    0	  255
	 657	    0	   31
	 658	    0	  255
	 659	    0	   31
	 660	    0	  255
	 661	    0	   31
	 662	    0	  255
	 663	    0	   31
	 664	    0	  255
	 665	    0	  127
	 666	    0	  255
	 667	    0	  127
	 668	    0	  255
	 669	    0	  127
	 670	    0	  255
	 671	    0	  127
	 672	    0	  255
	 673	    0	  127
	 674	    0	  255
	 675	    0	  127
	 676	    0	  255
	 677	    0	   15
	 678	    0	  255
	 679	    0	   15
	 680	    0	  255
	 681	    0	   15
	 682	    0	  255
	 683	    0	   15
	 684	    0	  255
	 685	    0	   15
	 686	    0	  255
	 687	    0	   15
	 688	    0	   63
	 689	    0	   63
	 690	    0	   63
	 692	    0	  255
	 693	    0	  255
	 694	    0	  255
	 695	    0	  255
	 696	    0	  127
	 768	    0	  127
	 769	    0	  255
	 770	    0	  255
	 771	    0	  255
	 772	    0	  255
	 773	    0	  255
	 774	    0	  255
	 775	    0	  255
	 776	    0	  255
	 784	    0	  255
	 800	    0	    3
	 801	    0	  127
	1016	    0	  255
	1017	    0	   15
	1018	    0	   63
	1019	    0	   63
	1020	  127	  255
	1022	    0	  255
];


%% REVISIONS
% 2010-04-19 Add Nevada registers